<script type="text/javascript">

var dataObj = {
	"cities": [
		{
			"name": "Madrid",
			"country": 1,
			"lat": 40.429203,
			"lng": -3.694986
		},
		
		{
			"name": "Barcelona",
			"country": 1,
			"lat": 41.401229,
			"lng": 2.170912
		},
		
		{
			"name": "Paris",
			"country": 2,
			"lat": 48.864393,
			"lng": 2.357188
		} 
	],
	
    "people": [
        {
            "name": "Alicia",
            "bankBalance": 188.12,
            "passport_no": "D01982711",
            "weight": 60.2,
            "heart_rate": 90,
            "age": 21,
            "body_temp": 36.6
        },
        
        {
            "name": "Shane",
            "bankBalance": 9873.11,
            "passport_no": "D99887123",
            "weight": 80.2,
            "heart_rate": 101,
            "age": 22,
            "body_temp": 41.6
        },
        
        {
            "name": "Bob",
            "bankBalance": 1076.11,
            "passport_no": "S654648132",
            "weight": 99.9,
            "heart_rate": 77,
            "age": 6,
            "body_temp": 36.8
        }
    ],
		
	"animals": [
 		{
 		    "name": "Sparky",
 		    "weight": 20.76,
 		    "heart_rate": 210,
 		    "age": 6,
 		    "body_temp": 35.0
 		},
		
 		{
 		    "name": "Cindy",
 		    "weight": 16.76,
 		    "heart_rate": 220,
 		    "age": 10,
 		    "body_temp": 30.0
 		}
	] 
};

getDist = function(lat1, long1, lat2, long2) {
    dtor = Math.PI/180;
    r = 6378.14;
 
    rlat1 = lat1 * dtor;
    rlong1 = long1 * dtor; 
    rlat2 = lat2 * dtor;
    rlong2 = long2 * dtor; 

    dlon = rlong1 - rlong2;
    dlat = rlat1 - rlat2;

    a = Math.pow(Math.sin(dlat/2), 2) + Math.cos(rlat1) * Math.cos(rlat2) *     Math.pow(Math.sin(dlon/2), 2);
    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    d = r * c;
    return d;
    };

function Car(fuel, currCity) {
    this.fuel = fuel;
    this.currCity = currCity;
    this.passengers = {};
    this.totalWeight = 0;
    this.getOn = function(passenger) {
        this.passengers[passenger.name] = passenger;
        this.totalWeight += passenger.weight;
    };
    this.getOff = function(passenger) {
        delete this.passengers[passenger.name];
    };
    this.travel = function(destCity) {
      var lat1 = this.currCity.lat;
      var long1 = this.currCity.lng;
      var lat2 = destCity.lat;
      var long2 = destCity.lng;
    
      var d = getDist(lat1, long1, lat2, long2);
    
      console.log("Travelling from " + this.currCity.name + " to " + 
      destCity.name + " :" + d + "km");

      var fuel_rate = 200 - 2 * (this.totalWeight / 10);
      this.fuel -= d / fuel_rate;
    
      for (var name in this.passengers) {
	    var passenger = this.passengers[name];
        if ((passenger instanceof Human) && (this.currCity.country != destCity.country)) {
          passenger.payCustoms();
        }
      }
	  
	  this.currCity = destCity;
    };
}

function City(name, country, lat, lng) {
    this.name = name;
    this.country = country;
    this.lat = lat;
    this.lng = lng;
}

function Animal(name, weight, age) {
    this.name = name;
    this.weight = weight;
    this.age = age;
}

function Human(name, weight, age, bankBalance) {
    this.bankBalance = bankBalance;
    this.payCustoms = function() {
      this.bankBalance -= (2.5 * this.age);
	};
	Animal.call(this, name, weight, age);
    
}
      
Human.prototype = new Animal();
Human.prototype.constructor = Human;

var animals = {};
var people = {};
var cities = {};

  
for (var i = 0; i < dataObj["animals"].length; i++) {
	var object = dataObj["animals"][i];
    animals[object["name"]] = new Animal(object["name"], object["weight"], object["age"]);
	};
for (var i = 0; i < dataObj["people"].length; i++) {
	var object = dataObj["people"][i];
    people[object["name"]] = new Human(object["name"], object["weight"], object["age"], object["bankBalance"]);
	};
for (var i = 0; i < dataObj["cities"].length; i++) {
	var object = dataObj["cities"][i];
    cities[object["name"]] = new City(object["name"], object["country"], object["lat"], object["lng"]);
	};

console.log(animals);
console.log(people);
console.log(cities);

car = new Car(100, cities["Barcelona"]);
car.getOn(people["Alicia"]);
car.getOn(people["Shane"]);
car.getOn(people["Bob"]);
car.getOn(animals["Sparky"]);

car.travel(cities["Madrid"]);
car.travel(cities["Paris"]);

car.getOff(people["Shane"]);
car.getOn(animals["Cindy"]);

car.travel(cities["Barcelona"]);

console.log("Remaining money: ");

for (var name in people) {
  var person = people[name];
  console.log(person.name + ": " + person.bankBalance);
};

console.log("Remaining gas: ");
console.log(car.fuel);
</script>